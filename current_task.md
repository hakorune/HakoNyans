# HakoNyans ğŸ± Current Task

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
é«˜é€Ÿãƒ‡ã‚³ãƒ¼ãƒ‰é‡è¦–ã®æ¬¡ä¸–ä»£ç”»åƒã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã€‚
NyANS-Pï¼ˆParallel Interleaved rANS + P-Indexï¼‰ã‚’ä¸­æ ¸ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã«æ¡ç”¨ã€‚

## å®Œäº†ã‚¿ã‚¹ã‚¯

### Phase 0: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— âœ…
- [x] ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆä½œæˆ
- [x] README.md
- [x] è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆSPEC / ENTROPY / P-INDEX / SIMD / BENCHMARKSï¼‰
- [x] CMakeLists.txt éª¨æ ¼ï¼ˆC++17ï¼‰
- [x] å…¬é–‹APIãƒ˜ãƒƒãƒ€ï¼ˆapi.h, version.hï¼‰
- [x] claude.mdï¼ˆç®±ç†è«–ï¼‰
- [x] git init + åˆå›ã‚³ãƒŸãƒƒãƒˆ

---

## å®Ÿè£…äºˆå®š

### Phase 1: rANS å˜ä½“ï¼ˆN=1ï¼‰âœ… å®Œäº†
**ç›®æ¨™**: encode â†’ decode ã®å¾€å¾©ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°å®Ÿè£…

- [x] `src/core/bitwriter.h` â€” ãƒ“ãƒƒãƒˆ/ãƒã‚¤ãƒˆæ›¸ãè¾¼ã¿
- [x] `src/core/bitreader.h` â€” ãƒ“ãƒƒãƒˆ/ãƒã‚¤ãƒˆèª­ã¿è¾¼ã¿
- [x] `src/entropy/nyans_p/rans_core.h` â€” rANS åŸºæœ¬æ“ä½œ
  - encode_symbol / decode_symbol
  - renormalize (LIFOå‡¦ç†ã€ãƒãƒƒãƒ•ã‚¡åè»¢)
  - CDF ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 
- [x] `src/entropy/nyans_p/rans_tables.h` â€” CDF/alias ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆï¼ˆRANS_TOTAL=4096 ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰
- [x] `tests/test_rans_simple.cpp` â€” 5 å¾€å¾©ãƒ†ã‚¹ãƒˆï¼ˆå…¨ãƒ‘ã‚¹ï¼‰
- [x] CMakeLists.txt æ›´æ–°ï¼ˆãƒ†ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰æœ‰åŠ¹åŒ–ï¼‰
- [x] å‹•ä½œç¢ºèªï¼ˆ10,000ã‚·ãƒ³ãƒœãƒ«ã®ãƒ©ãƒ³ãƒ€ãƒ å¾€å¾©æˆåŠŸï¼‰

**ç®±ç†è«–ãƒã‚§ãƒƒã‚¯**:
- âœ… bitstream box ã¨ entropy box ãŒç‹¬ç«‹
- âœ… ã‚¹ã‚«ãƒ©ãƒ¼å®Ÿè£…ãŒ golden reference

---

### Phase 2: N=8 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒªãƒ¼ãƒ– + ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ ğŸ”œ â† æ¬¡ã“ã“ã‹ã‚‰
**ç›®æ¨™**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒªãƒ¼ãƒ–ã§ ILP åŠ¹æœã‚’ç¢ºèªã€MiB/s è¨ˆæ¸¬

- [x] `src/entropy/nyans_p/rans_interleaved.h` â€” N=8 çŠ¶æ…‹ç®¡ç†ï¼ˆPhase 2: ç‹¬ç«‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ç‰ˆï¼‰
- [x] ãƒˆãƒ¼ã‚¯ãƒ³åŒ–: `src/entropy/nyans_p/tokenization.h`
- [x] `bench/bench_entropy.cpp` â€” N=1 vs N=8 ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆè¨ˆæ¸¬
- [x] ç›®æ¨™: >500 MiB/s â†’ LUTç‰ˆã§é”æˆ

---

### Phase 3: AVX2 SIMD å®Ÿè£… âœ… å®Œäº†
**ç›®æ¨™**: rANS ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’é«˜é€ŸåŒ– â†’ LUT: 2.80x, AVX2: 2.48x

- [x] `src/entropy/nyans_p/rans_flat_interleaved.h` â€” 8çŠ¶æ…‹ãƒ»1æœ¬ã‚¹ãƒˆãƒªãƒ¼ãƒ å…±æœ‰
- [x] `src/entropy/nyans_p/rans_tables.h` â€” slotâ†’symbol LUT (SIMDDecodeTable)
- [x] `src/simd/x86_avx2/rans_decode_avx2.h` â€” AVX2 gather+SIMD ãƒ‡ã‚³ãƒ¼ãƒ€
- [x] `src/simd/simd_dispatch.h` â€” ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  CPUID æ¤œå‡º + HAKONYANS_FORCE_SCALAR
- [x] `bench/bench_phase3.cpp` â€” 4ãƒ‘ã‚¹æ¯”è¼ƒãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [x] `tests/test_avx2_rans.cpp` â€” 4ãƒ†ã‚¹ãƒˆå…¨ãƒ‘ã‚¹

**ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœ** (Ryzen 9 9950X, -O3 -march=native):
| ãƒ‘ã‚¹ | ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦ | ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ— |
|------|-------------|---------------|
| N=1 scalar (baseline) | 185 MiB/s | 1.00x |
| N=8 flat scalar (CDF search) | 188 MiB/s | 1.02x |
| N=8 flat scalar (LUT) | **516 MiB/s** | **2.80x** âœ“ |
| N=8 AVX2 (bulk) | 457 MiB/s | 2.48x |

**åˆ†æ**: LUT ãŒæœ€å¤§ã®åŠ¹æœã€‚AVX2 gather ã¯ç¾è¡ŒCPUã§ã¯ã‚¹ã‚«ãƒ©ãƒ¼LUTã«åŠã°ãªã„ãŒã€P-Indexä¸¦åˆ—åŒ–ã‚„AVX-512æ™‚ä»£ã®åŸºç›¤ã¨ã—ã¦é‡è¦ã€‚
- [ ] `HAKONYANS_FORCE_SCALAR` ç’°å¢ƒå¤‰æ•°å¯¾å¿œ âœ…ï¼ˆsimd_dispatch.h ã§å®Ÿè£…æ¸ˆã¿ï¼‰

---

### Phase 4: P-Index ä¸¦åˆ—ãƒ‡ã‚³ãƒ¼ãƒ‰ âœ… å®Œäº†
**ç›®æ¨™**: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦ãŒã‚³ã‚¢æ•°ã«æ¯”ä¾‹

- [x] `src/entropy/nyans_p/pindex.h` â€” ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ§‹é€  + PIndexBuilder + ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
- [x] `src/platform/thread_pool.h` â€” ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ« + HAKONYANS_THREADS ç’°å¢ƒå¤‰æ•°
- [x] `src/entropy/nyans_p/parallel_decode.h` â€” P-Index ä¸¦åˆ—ãƒ‡ã‚³ãƒ¼ãƒ€ (CDF + LUT ç‰ˆ)
- [x] `tests/test_parallel.cpp` â€” 9ãƒ†ã‚¹ãƒˆå…¨ãƒ‘ã‚¹
- [x] 1/2/4/8/16 ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ™ãƒ³ãƒ

**ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœ** (Ryzen 9 9950X, 4M tokens):
| ã‚¹ãƒ¬ãƒƒãƒ‰ | ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦ | ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° |
|---------|-------------|-------------|
| 1 | 458 MiB/s | 1.00x |
| 2 | 859 MiB/s | 1.88x |
| 4 | 1533 MiB/s | 3.35x |
| 8 | 2366 MiB/s | 5.17x |
| 16 | 2528 MiB/s | 5.52x |

**åˆ†æ**: 4ã‚³ã‚¢ã¾ã§ã»ã¼ç·šå½¢ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆåŠ¹ç‡83%ï¼‰ã€‚8ã‚³ã‚¢ä»¥é™ã¯ãƒ¡ãƒ¢ãƒªå¸¯åŸŸã§é£½å’Œã€‚

---

### Phase 5: ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯çµ±åˆï¼ˆç”»åƒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼‰
**ç›®æ¨™**: .hkn ãƒ•ã‚¡ã‚¤ãƒ«ã® encode/decode ãŒå‹•ã
**è¨­è¨ˆæ›¸**: [docs/PHASE5_DESIGN.md](docs/PHASE5_DESIGN.md)

#### Step 5.1: Grayscale end-to-endï¼ˆæœ€å°å‹•ä½œç¢ºèªï¼‰â† é€²è¡Œä¸­ï¼ˆãƒ‡ãƒãƒƒã‚°ä¸­ï¼‰
- [x] `src/codec/zigzag.h` â€” Zigzag scan LUT âœ…
- [x] `src/codec/quant.h` â€” é‡å­åŒ–/é€†é‡å­åŒ– + JPEG-like quant matrix âœ…
- [x] `src/codec/transform_dct.h` â€” 8Ã—8 DCT/IDCTï¼ˆã‚¹ã‚«ãƒ©ãƒ¼ã€åˆ†é›¢å¯èƒ½ 1DÃ—2ï¼‰âœ…
- [x] `src/entropy/nyans_p/tokenization_v2.h` â€” ZRUN çµ±åˆç‰ˆï¼ˆDC/AC åˆ†é›¢å¯¾å¿œï¼‰âœ…
- [x] `src/codec/headers.h` â€” FileHeader(48B) + ChunkDirectory + QMAT âœ…
- [x] `tests/test_phase5_components.cpp` â€” ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆ7/7 PASSï¼‰âœ…
- [x] `src/codec/encode.h` â€” Grayscale ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ï¼ˆDCTâ†’é‡å­åŒ–â†’ZRUNâ†’rANSâ†’.hknï¼‰âœ… (ãƒ“ãƒ«ãƒ‰ OK)
- [x] `src/codec/decode.h` â€” Grayscale ãƒ‡ã‚³ãƒ¼ãƒ€ï¼ˆ.hknâ†’rANSâ†’ZRUNâ†’é€†é‡å­åŒ–â†’IDCTï¼‰âœ… (ãƒ“ãƒ«ãƒ‰ OK)
- [x] `tests/test_codec_gray.cpp` â€” ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«å¾€å¾©ãƒ†ã‚¹ãƒˆ âœ… (ä½œæˆ)
- [x] ãƒ‡ãƒãƒƒã‚°å®Œäº†ï¼šå…¨ãƒ†ã‚¹ãƒˆ PASS âœ…
  - CDF å‘¨æ³¢æ•°ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ä¿®æ­£ï¼ˆrans_tables.hï¼‰
  - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚µã‚¤ã‚º 256â†’76ï¼ˆencode.h/decode.hï¼‰
  - AC EOB æ¬ è½ä¿®æ­£ï¼šå…¨ä¿‚æ•°ãŒéã‚¼ãƒ­æ™‚ã« ZRUN_63 æœªä»˜åŠ ï¼ˆtokenization_v2.hï¼‰
  - IDCT ä¸¸ã‚ä¿®æ­£ï¼šè² ã®å€¤ã§èª¤å·®ï¼ˆtransform_dct.hï¼‰
- [x] PSNR è¨ˆæ¸¬ï¼šQ75=46.1dB, Q90=47.7dB, Q100=49.0dB âœ…

#### Step 5.2: Colorï¼ˆYCbCr 4:4:4ï¼‰âœ… å®Œäº†
- [x] `src/codec/colorspace.h` â€” RGB â†” YCbCr æ•´æ•°è¿‘ä¼¼ âœ…
- [x] 3ãƒãƒ£ãƒ³ãƒãƒ«ç‹¬ç«‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ âœ…
- [x] `tests/test_codec_color.cpp` â€” ã‚«ãƒ©ãƒ¼å¾€å¾©ãƒ†ã‚¹ãƒˆï¼ˆPSNR 39.4dBï¼‰âœ…
- [x] PPM ã®ç°¡æ˜“èª­ã¿æ›¸ãï¼ˆå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—ï¼‰âœ…

#### Step 5.3: DC DPCM + P-Index çµ±åˆ âœ… å®Œäº†
- [x] DC ä¿‚æ•°ãƒãƒ£ãƒ³ã‚¯å†… DPCMï¼ˆãƒãƒ£ãƒ³ã‚¯å¢ƒç•Œã§ãƒªã‚»ãƒƒãƒˆï¼‰âœ…
- [x] Phase 4 ã® P-Index ã‚’ codec ã«çµ±åˆ âœ…
- [x] ã‚¿ã‚¤ãƒ«åˆ†å‰²ï¼ˆå¤§ç”»åƒå¯¾å¿œï¼‰âœ…
- [x] ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‡ã‚³ãƒ¼ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ âœ…

#### Step 5.4: CLI + ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ âœ… å®Œäº†
- [x] `tools/hakonyans_cli.cpp` â€” `hakonyans encode/decode/info` âœ…
- [x] `bench/bench_decode.cpp` â€” Full HD end-to-endï¼ˆ232 MiB/sï¼‰âœ…
- [ ] libjpeg-turbo ã¨ã®é€Ÿåº¦æ¯”è¼ƒï¼ˆåŒ qualityï¼‰â† Phase 6
- [ ] PSNR vs bpp ã‚«ãƒ¼ãƒ–ï¼ˆquality 1-100ï¼‰â† Phase 6

---

### Phase 6: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å¯¾æ±º âœ… å®Œäº†
**ç›®æ¨™**: libjpeg-turbo / libjxl / libavif ã¨ã®æ¯”è¼ƒ

- [x] `bench/bench_compare.cpp` â€” å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã®é€Ÿåº¦æ¯”è¼ƒ âœ…
- [x] Full HD / 4K ãƒ†ã‚¹ãƒˆç”»åƒã‚»ãƒƒãƒˆ âœ…
- [x] åœ§ç¸®ç‡ vs ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚°ãƒ©ãƒ• âœ…
- [x] PSNR vs bpp ã‚«ãƒ¼ãƒ–ï¼ˆquality 1-100ï¼‰ âœ…
- [x] BENCHMARKS.md æ›´æ–° âœ…

**çµæœ**: HakoNyans ã¯ JPEG-XL ã‚ˆã‚Š 1.23x é«˜é€Ÿã€AVIF ã‚ˆã‚Š 5.5x é«˜é€Ÿã€‚å“è³ªã¯ 41.3 dB ã§ JPEG ã® 34.6 dB ã‚’ä¸Šå›ã‚‹ã€‚

---

### Phase 7a: åœ§ç¸®ç‡æ”¹å–„ï¼ˆ4ã‚¹ãƒ†ãƒƒãƒ—ï¼‰ âœ… å®Œäº†
**ç›®æ¨™**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º 1004 KB â†’ 490 KB é”æˆï¼ˆ6x â†’ 2.9x JPEG æ¯”ï¼‰

- [x] **Step 1: é©å¿œé‡å­åŒ–ï¼ˆDææ¡ˆï¼‰** â€” ãƒ–ãƒ­ãƒƒã‚¯è¤‡é›‘åº¦ã«å¿œã˜ãŸ qstep èª¿æ•´ âœ…
- [x] **Step 2: 4:2:0 ã‚µãƒ–ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆEææ¡ˆï¼‰** â€” ã‚¯ãƒ­ãƒãƒ€ã‚¦ãƒ³ã‚µãƒ³ãƒ—ãƒ« + ã‚¢ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒ« âœ…
- [x] **Step 3: CfLï¼ˆAææ¡ˆï¼‰** â€” è¼åº¦ã‹ã‚‰ã®è‰²äºˆæ¸¬ã§æ®‹å·®åœ§ç¸® âœ…
- [x] **Step 4: Band-group CDFï¼ˆFææ¡ˆï¼‰** â€” å‘¨æ³¢æ•°å¸¯åŸŸåˆ¥ CDF ã§é©å¿œç¬¦å·åŒ– âœ…

**åœ§ç¸®åŠ¹æœ** (Full HD 1920Ã—1080, lena.ppm):
| ãƒ•ã‚§ãƒ¼ã‚º | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | å‰Šæ¸›é‡ | PSNR (Gray) | PSNR (Color) |
|---------|-------------|-------|------------|------------|
| Phase 6 (baseline) | 1004 KB | - | 40.8 dB | 39.4 dB |
| +AQ (Step 1) | 870 KB | -13% | 40.6 dB | 39.2 dB |
| +4:2:0 (Step 2) | 580 KB | -42% | 40.3 dB | 38.8 dB |
| +CfL (Step 3) | 530 KB | -47% | 40.3 dB | 38.5 dB |
| +Band CDF (Step 4) | **484 KB** | **-52%** | **40.3 dB** | **23.5 dB** |

**åˆ†æ**:
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç›®æ¨™é”æˆï¼ˆ490 KB ç›®æ¨™ã€å®Ÿç¸¾ 484 KBï¼‰
- âœ… ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«å“è³ªç¶­æŒï¼ˆ40.3 dBï¼‰
- âš ï¸ ã‚«ãƒ©ãƒ¼å“è³ªèª²é¡Œï¼ˆ23.5 dBã€åŸå› : CfL å®Ÿè£…ã®æ”¹å–„ãŒå¿…è¦ï¼‰
- âœ… ç·å‰Šæ¸›ç‡ 52%ï¼ˆå½“åˆ 6x â†’ ç¾åœ¨ 2.9x JPEG æ¯”ï¼‰

---

### Phase 7b: ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦æ”¹å–„ âœ… å®Œäº†
**ç›®æ¨™**: 36 ms â†’ 29 msï¼ˆFull HDï¼‰

- [x] **AVX2 è‰²å¤‰æ› int16 ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ä¿®æ­£** â€” ä¿‚æ•°ã‚’ shift-8â†’shift-7 ã«å¤‰æ›´ï¼ˆPSNR 13dBâ†’42.6dBï¼‰
- [x] **å›ºå®šå°æ•°ç‚¹ IDCT** â€” cos() å‘¼ã³å‡ºã—ã‚’äº‹å‰è¨ˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç½®æ›ï¼ˆ36msâ†’29.2ms, -19%ï¼‰
- [x] **ãƒ¡ãƒ¢ãƒªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ–** â€” ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹å‡¦ç†ï¼ˆGeminiå®Ÿè£…ï¼‰
- [x] ãƒ†ã‚¹ãƒˆ: å…¨ 11/11 PASS

**ãƒ‡ã‚³ãƒ¼ãƒ‰é€Ÿåº¦**: 36ms â†’ **29.2ms (-19%)**ã€203 MiB/s

---

### Phase 7c: ã•ã‚‰ãªã‚‹æœ€é©åŒ– âœ… å®Œäº†
**ç›®æ¨™**: AAN butterfly IDCT + Screen Profile

- [x] **Task 1: AAN butterfly IDCT** â€” æ•´æ•° butterflyï¼ˆLoeffler/AAN ç³»ï¼‰ã«å·®ã—æ›¿ãˆ
- [x] **Task 1.5: ãƒ‡ã‚³ãƒ¼ãƒ‰ä¸¦åˆ—åº¦èª¿æ•´** â€” `std::async` ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ä¸Šé™ã‚’ 8 ã«åˆ¶é™
- [x] **Task 1 çµæœ** â€” Full HD decode: **27.8ms â†’ 19.5ms**, **305 MiB/s**, å…¨ 11/11 ãƒ†ã‚¹ãƒˆ PASS
- [x] **Task 2: Screen Profileï¼ˆPalette + 2D Copyï¼‰** â€” ã‚¹ã‚¯ã‚·ãƒ§ç‰¹åŒ–åœ§ç¸® âœ… å®Œäº†
  - Palette ãƒ¢ãƒ¼ãƒ‰: 8è‰²ä»¥ä¸‹ã®ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆé »åº¦ãƒ™ãƒ¼ã‚¹æŠ½å‡ºã€Deltaç¬¦å·åŒ–ï¼‰
  - 2D Copy ãƒ¢ãƒ¼ãƒ‰ (IntraBC): ç¹°ã‚Šè¿”ã—ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆSADæ¢ç´¢ã€Â±64ãƒ–ãƒ­ãƒƒã‚¯ç¯„å›²ï¼‰
  - è‡ªå‹•ãƒ¢ãƒ¼ãƒ‰é¸æŠ: Copy â†’ Palette â†’ DCT ã®å„ªå…ˆé †ä½
  - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ v2 å¯¾å¿œ
  - å…¨ 15/15 ãƒ†ã‚¹ãƒˆ PASS
- [x] **Task 3: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿæ–½** â€” Screen Profile ã®åœ§ç¸®åŠ¹æœã‚’å®Ÿæ¸¬ âœ… å®Œäº†
  - UI Screenshots: **-52.1%** ã‚µã‚¤ã‚ºå‰Šæ¸›ï¼ˆbrowser -56.9%, vscode -52.2%ï¼‰
  - Game Screens: æ··åˆçµæœï¼ˆ-8.9% ï½ +85.7%ï¼‰
  - Photos: éæ¨å¥¨ï¼ˆ+36.9% å¹³å‡å¢—åŠ ï¼‰
  - ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«å®Ÿè£…: `bench/bench_screen_profile.cpp`
  - æ¯”è¼ƒç”»åƒç”Ÿæˆ: `bench_results/screen_profile_compare/` (30ãƒ•ã‚¡ã‚¤ãƒ«ã€63MB)
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼ˆPhase 7c å®Œå…¨ç‰ˆ + ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœï¼‰

---

### Phase 8: ãƒ­ã‚¹ãƒ¬ã‚¹åœ§ç¸®ãƒ¢ãƒ¼ãƒ‰ âœ… å®Œäº†
**ç›®æ¨™**: PNGä»£æ›¿ã¨ãªã‚‹å®Œå…¨å¯é€†åœ§ç¸®ãƒ¢ãƒ¼ãƒ‰

- [x] **YCoCg-R å¯é€†å¤‰æ›** â€” æ•´æ•°æ¼”ç®—ã€+0.5dB coding gain
- [x] **å·®åˆ†ãƒ•ã‚£ãƒ«ã‚¿ 5ç¨®** â€” PNGäº’æ›ï¼ˆNone/Sub/Up/Average/Paethï¼‰
- [x] **ã‚¿ã‚¤ãƒ«ç‹¬ç«‹ä¸¦åˆ—** â€” 256Ã—256 ã‚¿ã‚¤ãƒ«ã§å®Œå…¨ä¸¦åˆ—ãƒ‡ã‚³ãƒ¼ãƒ‰
- [x] **ZigZagå¤‰æ›** â€” signed â†’ unsigned å¤‰æ›
- [x] **MAGC+REMçµ±åˆ** â€” æ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã‚’æ®‹å·®ã«é©ç”¨
- [x] **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€å®Ÿè£…** â€” `encode_lossless()` / `encode_color_lossless()`
- [x] **ãƒ‡ã‚³ãƒ¼ãƒ€å®Ÿè£…** â€” `decode_lossless()` / `decode_color_lossless()`
- [x] **ãƒ†ã‚¹ãƒˆ Round 1** â€” YCoCg-R + ãƒ•ã‚£ãƒ«ã‚¿åŸºç›¤ï¼ˆ7/7 PASSï¼‰
- [x] **ãƒ†ã‚¹ãƒˆ Round 2** â€” ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯å®Œå…¨ä¸€è‡´ï¼ˆ7/7 PASSï¼‰
- [x] **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯** â€” UIç”»åƒ 84-94% åœ§ç¸®é”æˆ

**å®Ÿè£…å†…å®¹**:
- `src/codec/lossless_filter.h` (æ–°è¦) â€” 190è¡Œ
- `src/codec/colorspace.h` â€” YCoCg-R è¿½åŠ 
- `tests/test_lossless_round1.cpp` (æ–°è¦) â€” 303è¡Œ
- `tests/test_lossless_round2.cpp` (æ–°è¦) â€” 249è¡Œ
- `bench/bench_lossless.cpp` (æ–°è¦) â€” 195è¡Œ

**ãƒ†ã‚¹ãƒˆçµæœ**: 17/17 å…¨ãƒ†ã‚¹ãƒˆ PASS
**å®Ÿè£…è€…**: Claude Opus 4.6

---

### Phase 8b: PNGå¯¾æ±ºãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ âœ… å®Œäº†
**ç›®æ¨™**: HakoNyans Lossless ã®å®ŸåŠ›ã‚’ PNG ã¨ç›´æ¥æ¯”è¼ƒ

- [x] **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«ä½œæˆ** â€” `bench/bench_png_compare.cpp`
  - libpng ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰
  - png_wrapper.h / ppm_loader.h å®Ÿè£…
  - æ¯”è¼ƒé …ç›®ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ™‚é–“ã€ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚é–“
- [x] **ãƒ†ã‚¹ãƒˆç”»åƒæº–å‚™** â€” ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡ï¼ˆ15æšï¼‰
  - UI Screenshotsï¼ˆ3æšï¼‰
  - Natural Photosï¼ˆ4æšã€Kodak datasetï¼‰
  - Animeï¼ˆ4æšã€5Ké«˜è§£åƒåº¦å«ã‚€ï¼‰
  - Gameï¼ˆ2æšï¼‰
  - Syntheticï¼ˆ2æšã€åˆæˆç”»åƒï¼‰
- [x] **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ** â€” å…¨15æšã§æ¸¬å®šå®Œäº†
- [x] **çµæœåˆ†æ** â€” **æ·±åˆ»ãªãƒã‚°ç™ºè¦‹**
  - UI/Anime/Game: PNGåœ§å‹ï¼ˆ15-120å€å·®ï¼‰
  - Photo: HKNå‹åˆ©ï¼ˆ-8~-10%ï¼‰
  - åŸå› : CDFãƒ˜ãƒƒãƒ€ãƒ¼ or ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚ºå•é¡Œ
- [x] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** â€” `docs/BENCHMARKS.md` ã«çµæœè¿½åŠ 

**çµæœ**: Phase 8 Lossless ã«ãƒã‚°ç™ºè¦‹ â†’ Phase 8c ã§ä¿®æ­£

---

### Phase 8c: Lossless ãƒã‚°ä¿®æ­£ âœ… å®Œäº†
**ç›®æ¨™**: 150KBå›ºå®šã‚µã‚¤ã‚ºå•é¡Œã‚’ä¿®æ­£ + Phase 8c ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ä¿®æ­£

#### Phase 8c-v1: Screen Profileçµ±åˆï¼ˆå¤±æ•—ï¼‰
- [x] Screen Profileçµ±åˆ + é™çš„CDFå®Ÿè£…
- [x] ãƒ†ã‚¹ãƒˆ: 17/17 PASS
- [x] ãƒ™ãƒ³ãƒçµæœ: **2-7å€æ‚ªåŒ–**ï¼ˆSolid 11.6KBâ†’23.4KBã€UI 35.4KBâ†’87.2KBï¼‰
- [x] å•é¡Œç™ºè¦‹: å‡ä¸€CDFã€è¡Œåˆ†å‰²ãƒ•ã‚£ãƒ«ã‚¿ã€åˆ¤å®šé †ãƒŸã‚¹

#### Phase 8c-v2: ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ä¿®æ­£ï¼ˆæˆåŠŸï¼‰âœ…
- [x] **ä¿®æ­£1: ãƒ‡ãƒ¼ã‚¿é©å¿œCDFå¾©æ´»** â€” å‡ä¸€é™çš„CDFå‰Šé™¤ã€å‹•çš„CDFå¾©æ´»
  - rANSåœ§ç¸®ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ãŸå•é¡Œã‚’è§£æ±º
  - æ®‹å·®ã¯0ä¸­å¿ƒã®éå‡ä¸€åˆ†å¸ƒ â†’ ãƒ‡ãƒ¼ã‚¿é©å¿œCDFãŒå¿…é ˆ
- [x] **ä¿®æ­£2: ãƒ•ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚£ãƒ«ã‚¿** â€” ãƒ–ãƒ­ãƒƒã‚¯è¡Œåˆ†å‰²â†’ãƒ•ãƒ«äºˆæ¸¬ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  - Palette/Copyç”»ç´ ã‚’ã‚¢ãƒ³ã‚«ãƒ¼ã¨ã—ã¦ä½¿ç”¨
  - è¡Œé–“ç›¸é–¢ã‚’8è¡Œã§åˆ‡æ–­ã—ã¦ã„ãŸå•é¡Œã‚’è§£æ±º
- [x] **ä¿®æ­£3: åˆ¤å®šé †å¤‰æ›´** â€” Copyâ†’Paletteâ†’Filter
  - Solidç”»åƒã§Copyï¼ˆ4B/blockï¼‰ã‚’å„ªå…ˆä½¿ç”¨
  - Paletteï¼ˆ~9B/blockï¼‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰å‰Šæ¸›
- [x] **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ** â€” 17/17 PASSã€bit-exact ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ— âœ…
- [x] **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯** â€” UI/Gradientã§æ”¹å–„ã€Solidã®ã¿å¾®å¢—

**æœ€çµ‚çµæœ**:
- UI: 35.4KB â†’ **30.9KB** (-12.7% âœ…)
- Gradient: 33.8KB â†’ **32.2KB** (-4.7% âœ…)
- Solid: 11.6KB â†’ **15.2KB** (+31% âš ï¸ Copyã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰)

**æ¬¡**: Phase 8dï¼ˆPNGå†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰æº–å‚™å®Œäº†

---

### Phase 8d: PNGå†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ âœ… å®Œäº† (2026-02-11)
**ç›®æ¨™**: Copy/Palette streamæœ€é©åŒ–å¾Œã®æœ€çµ‚æ¤œè¨¼

- [x] **Copy codecå¼·åŒ–** â€” å‹•çš„0/1/2-bitç¬¦å·åŒ–ï¼ˆmode=2ï¼‰
- [x] **Palette stream v2** â€” å˜è‰²çœç•¥ + 2è‰²ãƒã‚¹ã‚¯è¾æ›¸
- [x] **PNGå†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯** â€” å…¨ã‚«ãƒ†ã‚´ãƒªã§åŠ‡çš„æ”¹å–„ç¢ºèª
- [x] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** â€” BENCHMARKS.md, DEVELOPMENT_HISTORY.md, README.md

**æœ€çµ‚çµæœ**:
- UI: **39.0x â†’ 3.20x**ï¼ˆ-91.8%ã€browser 2.15x ğŸ†ï¼‰
- Anime: **41.5x â†’ 4.02x**ï¼ˆ-90.3%ï¼‰
- Game: **43.1x â†’ 3.90x**ï¼ˆ-90.9%ï¼‰
- Photo: **0.93x â†’ 0.72x**ï¼ˆPNGæ¯”28%å‰Šæ¸› âœ…ï¼‰

---

### Phase 8e: Artoria Decode Bug Fix âœ… å®Œäº† (2026-02-11)
**ç›®æ¨™**: é«˜è§£åƒåº¦ã‚¢ãƒ‹ãƒ¡ç”»åƒã®ãƒ­ã‚¹ãƒ¬ã‚¹ãƒ‡ã‚³ãƒ¼ãƒ‰ãƒã‚°ä¿®æ­£

- [x] **ãƒã‚°ç‰¹å®š** â€” Palette v2 è¾æ›¸ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ï¼ˆ255å€‹ä¸Šé™ï¼‰
- [x] **ä¿®æ­£å®Ÿè£…** â€” `dict_overflow` ãƒã‚§ãƒƒã‚¯è¿½åŠ ã€Raw mode ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [x] **æ¤œè¨¼** â€” Artoria/Nitocris ä¸¡æ–¹ã§ PSNR = INF ç¢ºèª
- [x] **å›å¸°ãƒ†ã‚¹ãƒˆ** â€” 17/17 PASS
- [x] **bench_results çµ±ä¸€** â€” å‡ºåŠ›å…ˆã‚’ `bench_results/` ã«çµ±ä¸€

**ä¿®æ­£çµæœ**:
- Artoria (5120Ã—3157): **7.5dB â†’ INF**ï¼ˆå®Œå…¨ä¿®æ­£ ğŸ‰ï¼‰
- Nitocris (5120Ã—3157): **INF â†’ INF**ï¼ˆå›å¸°ãªã— âœ…ï¼‰

**Phase 8 å®Œå…¨é”æˆ** ğŸ‰ğŸ‰ğŸ‰

---

## Phase 9å€™è£œï¼ˆæœªå®Ÿè£…ï¼‰

### Phase 9a: Lossless Auto Profileï¼ˆè¨­è¨ˆï¼‰âœ… å®Œäº†
**ç›®æ¨™**: ç”»åƒã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ Copy/Palette/Filter ã‚’è‡ªå‹•æœ€é©åŒ–ã—ã€UIãƒ¯ãƒ¼ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ”¹å–„

- [x] è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ â€” `docs/PHASE9_LOSSLESS_PROFILE_PLAN.md`
- [x] ç‰¹å¾´é‡å®šç¾©ï¼ˆU/T/gX/gY/var/hash/CopyHitï¼‰
- [x] ç”»åƒãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«ï¼ˆEditorUI/BrowserUI/FlatUI/PixelArt/Anime/Photoï¼‰
- [x] Blockåˆ¤å®šã—ãã„å€¤ï¼ˆCopyâ†’Paletteâ†’Filterï¼‰ã‚’æ•°å€¤ã§ç¢ºå®š
- [x] P0/P1/P2 ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—æ•´ç†
- [x] æ¤œè¨¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆAblation + æˆåŠŸåŸºæº– + ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

### Phase 9b: Lossless Auto Profileï¼ˆå®Ÿè£…ï¼‰ğŸš§ æœªç€æ‰‹
**ç›®æ¨™**: P0ã‚’ encoder-only ã§å°å…¥ã—ã€äº’æ›ã‚’ç¶­æŒã—ãŸã¾ã¾åœ§ç¸®ç‡ã‚’åº•ä¸Šã’

- [ ] ç”»åƒãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¤å®šã‚’ `encode_plane_lossless()` å‰æ®µã«è¿½åŠ 
- [ ] P0æ±ºå®šæœ¨ï¼ˆCopy/Palette/Filterï¼‰ã‚’å®Ÿè£…
- [ ] Copyè¾æ›¸ï¼ˆ`hash -> last_pos`ï¼‰å°å…¥
- [ ] ã‚¿ã‚¤ãƒ«å˜ä½ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆoptimized vs baselineï¼‰å®Ÿè£…
- [ ] ãƒ™ãƒ³ãƒå†æ¸¬å®šï¼ˆUI/Anime/Game/Photo + ablationï¼‰

### Phase 9c: ä»•æ§˜æ‹¡å¼µå€™è£œï¼ˆP1/P2ï¼‰ğŸ§ª
- [ ] Palette index æ–‡è„ˆåŒ– + RLE
- [ ] Copyè¾æ›¸ multi-candidate åŒ–ï¼ˆ`hash -> vector<pos>`ï¼‰
- [ ] block_types ã® 9æ–‡è„ˆã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æœ€é©åŒ–
- [ ] Tile palette dictionary / delta paletteï¼ˆè¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ‹¡å¼µï¼‰
